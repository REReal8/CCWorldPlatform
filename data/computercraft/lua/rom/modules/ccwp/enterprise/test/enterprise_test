local enterprise_test = {}

local coreutils = require "coreutils"
local corelog = require "corelog"

local InputChecker = require "input_checker"
local MethodExecutor = require "method_executor"

local enterprise_assignmentboard = require "enterprise_assignmentboard"

--[[
    The test enterprise offers test services for debugging/ testing purposes.
--]]

function enterprise_test.Test_SSrv(...)
    -- get & check input from description
    local checkSuccess, serviceData, testArg = InputChecker.Check([[
        This public sync service returns a test argument.

        Return value:
            success             - (boolean) whether the service executed successfully
            input               - (?) the test input argument

        Parameters:
            serviceData         + (table) data about the service
                testArg         + (?) as a test argument
    --]], table.unpack(arg))
    if not checkSuccess then corelog.Error("enterprise_test.Test_SSrv: Invalid input") return {success = false} end

--    corelog.WriteToLog(">calling enterprise_test.Test_SSrv("..textutils.serialize(serviceData)..")")

    -- determine result to return
    local serviceResult = {
        success = true,
        input = testArg,
    }
    if type(serviceData.serviceResult) == "table" then
        serviceResult.success = serviceData.serviceResult.success
    end

    return serviceResult
end

function enterprise_test.Test_ASrv(...)
    -- get & check input from description
    local checkSuccess, testArg, callback, callbackData = InputChecker.Check([[
        This public async service executes an assignment with a callback function and callback data.

        Return value:
            nil

        Async service return value (to callback):
                                - (table)
                success         - (boolean) whether the service executed successfully
                input           - (?) the test input argument

        Parameters:
            serviceData         - (table) data about the service
                testArg         + (number) as a test argument
            callback            + (string) name of function to call once service is ready
            callbackData        + (table) data to supply to callback function
    --]], table.unpack(arg))
    if not checkSuccess then corelog.Error("enterprise_test.Test_ASrv: Invalid input") return MethodExecutor.DoCallback(callback, callbackData, {success = false}) end

--    corelog.WriteToLog(">calling enterprise_test.Test_ASrv("..textutils.serialize(serviceData)..", "..callback..", "..textutils.serialize(callbackData)..")")

    -- create assignment arguments
    local metaData = {
        startTime = coreutils.UniversalTime(),
        location = {x= 0, y= 0, z= 1, dx=0, dy=1},
        needTool = false,
        needTurtle = false,
        fuelNeeded = 0
    }
    local taskData = {
        arg1 = testArg
    }

    -- do assignment
    local assignmentServiceData = {
        metaData    = metaData,
        task        = "role_test.Func1_Task",
        taskData    = taskData,
    }
    enterprise_assignmentboard.DoAssignment_ASrv(assignmentServiceData, callback, callbackData)
end

return enterprise_test
