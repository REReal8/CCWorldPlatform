local t_projects = {}

local corelog = require "corelog"

local enterprise_projects = require "enterprise_projects"

function t_projects.T_All()
    t_projects.T_AreAllTrue_QSrv()
    t_projects.T_DeleteProjects()
end

function t_projects.T_AreAllTrue_QSrv()
    -- prepare test
    corelog.WriteToLog("* enterprise_projects.AreAllTrue_QSrv() tests")
    local serviceData = {
        booleanArg1 = true,
        booleanArg2 = true,
        booleanArg3 = true,
        booleanArg4 = true,
    }

    -- test all boolean true
    local result = enterprise_projects.AreAllTrue_QSrv(serviceData)
    local expectedSuccess = true
    assert(result.success, "gotten AreAllTrue_QSrv(="..tostring(result.success)..") not the same as expected(="..tostring(expectedSuccess)..")")

    -- test ignore none boolean arguments
    serviceData.noneBooleanArg1 = "none boolean Arg1"
    serviceData.noneBooleanArg2 = "none boolean Arg2"
    result = enterprise_projects.AreAllTrue_QSrv(serviceData)
    expectedSuccess = true
    assert(result.success, "gotten AreAllTrue_QSrv(="..tostring(result.success)..") not the same as expected(="..tostring(expectedSuccess)..")")

    -- test one boolean false
    serviceData.booleanArg3 = false
    result = enterprise_projects.AreAllTrue_QSrv(serviceData)
    expectedSuccess = false
    assert(not result.success, "gotten AreAllTrue_QSrv(="..tostring(result.success)..") not the same as expected(="..tostring(expectedSuccess)..")")
    serviceData.booleanArg3 = true

    -- cleanup test
end

function t_projects.T_StartProject_ASrv()
    -- prepare test
    corelog.WriteToLog("* enterprise_projects.StartProject_ASrv() tests")
    local testArgValue = 20
    local projectDef = {
        steps   = {
            { stepName = "enterprise_test.TestPureLogicService_SSrv", async = false, stepDataDef = {
                { keyDef = "testArg"    , valueSource = 0, keyDefSource = "testArgSource" },
            }},
            { stepName = "enterprise_test.TestServiceWithAssignmentAndCallbackAndArguments_ASrv", async = true, stepDataDef = {
                { keyDef = "testArg"    , valueSource = 0, keyDefSource = "testArgSource" },
            }},
            { stepName = "enterprise_test.TestPureLogicService_SSrv", async = false, stepDataDef = {
                { keyDef = "testArg"    , valueSource = 0, keyDefSource = "testTableSource.key3.nKey2" },
            }},--[[ -- ToDo: figure out why both of these steps causes the infamous failure on serializing
            { stepName = "enterprise_test.TestPureLogicService_SSrv", async = false, stepDataDef = {
                { keyDef = "testArg"    , valueSource = 0, keyDefSource = "testTable2" },
                { keyDef = "testArg.field2" , valueSource = 0, keyDefSource = "testTable3" },
                { keyDef = "testArg.field2.field3" , valueSource = 0, keyDefSource = "testArgSource" },
            }},]]
            { stepName = "enterprise_test.TestPureLogicService_SSrv", async = false, stepDataDef = {
                { keyDef = "testArg"    , valueSource = 0, keyDefSource = "testTable4" },
                { keyDef = "testArg.field4" , valueSource = 0, keyDefSource = "testTableSource2.key4" },
            }},
        },
        returnData  = {
            { keyDef = "testBArg0"      , valueSource = 0, keyDefSource = "testArgSource" },
            { keyDef = "testBArg1"      , valueSource = 1, keyDefSource = "input" },
            { keyDef = "testBArg2"      , valueSource = 2, keyDefSource = "input" },
            { keyDef = "testBArg3"      , valueSource = 3, keyDefSource = "input" },
            { keyDef = "testBArg4"      , valueSource = 4, keyDefSource = "input" },
--            { keyDef = "testBArg5"      , valueSource = 5, keyDefSource = "input" },
        }
    }
    local projectData = {
        testArgSource = testArgValue,
        testTableSource = {
            key1 = 11,
            key2 = 22,
            key3 = {
                nKey1 = 111,
                nKey2 = 222,
                nKey3 = 333,
            }
        },
        testTable2 = { },
        testTable3 = { },
        testTableSource2 = {
            key4 = 44,
            key5 = 55,
        },
        testTable4 = { },
    }
    local callbackFunction = "t_main.Func1_Callback"
    local callbackData = { "rootCallBackData" }
    local projectServiceData = {
        projectDef  = projectDef,
        projectData = projectData,
    }

    -- test
    enterprise_projects.StartProject_ASrv(projectServiceData, callbackFunction, callbackData)

    -- cleanup test
end

function t_projects.T_DeleteProjects()
    -- prepare test
    corelog.WriteToLog("* enterprise_projects.DeleteProjects() test")

    -- test
    enterprise_projects.DeleteProjects()
    local nProjects = enterprise_projects.GetNumberOfProjects_Att()
    local expectedNProjects = 0
    assert(nProjects == expectedNProjects, "gotten nProjects(="..nProjects..") not the same as expected(="..expectedNProjects..")")

    -- cleanup test
end

return t_projects
