local t_shop = {}

local corelog = require "corelog"

local Callback = require "obj_callback"

local enterprise_turtle = require "enterprise_turtle"
local enterprise_shop = require "enterprise_shop"

function t_shop.T_All()
    t_shop.T_RegisterItemSupplier()
    t_shop.T_DelistItemSupplier()
    t_shop.T_DelistItemSuppliers()
end

local callback = Callback:new({
    _moduleName     = "t_main",
    _methodName     = "Func1_Callback",
    _data           = {"some callback data"},
})

function t_shop.T_OrderMultipleItems()
    return enterprise_shop.OrderItems_ASrv({
        orderItems = {
            ["minecraft:furnace"]   = 1,
            ["minecraft:charcoal"]  = 1, -- ToDo: test if furnace get produced once charcoal is being smelted (as soon as projects support parallel steps)
        },
        itemDepotLocator = enterprise_turtle.GetHostLocator_Att(),
    }, callback)
end

function t_shop.T_OrderCharcoal()
    return enterprise_shop.OrderItems_ASrv({
        orderItems = {
            ["minecraft:charcoal"]  = 3,
        },
        itemDepotLocator = enterprise_turtle.GetHostLocator_Att(),
    }, callback)
end

function t_shop.T_OrderTorch()
    return enterprise_shop.OrderItems_ASrv({
        orderItems = {
            ["minecraft:torch"]  = 4,
        },
        itemDepotLocator = enterprise_turtle.GetHostLocator_Att(),
    }, callback)
end

function t_shop.T_RegisterItemSupplier()
    -- prepare test
    corelog.WriteToLog("* enterprise_shop.RegisterItemSupplier_SSrv() tests")
    local originalNItemSuppliers = #enterprise_shop.GetItemSuppliers()
    local itemSupplierLocator = enterprise_turtle.GetHostLocator_Att()
    corelog.WriteToLog("   itemSupplierLocator="..itemSupplierLocator:getURI())

    -- test
    local result = enterprise_shop.RegisterItemSupplier_SSrv({ itemSupplierLocator = itemSupplierLocator})
    assert(result.success == true, "RegisterItemSupplier_SSrv services failed")
    local nItemSuppliers = #enterprise_shop.GetItemSuppliers()
    local expectedNItemSuppliers = originalNItemSuppliers + 1
    assert(nItemSuppliers == expectedNItemSuppliers, "gotten nItemSuppliers(="..nItemSuppliers..") not the same as expected(="..expectedNItemSuppliers..")")

    -- cleanup test
end

function t_shop.T_DelistItemSupplier()
    -- prepare test
    corelog.WriteToLog("* enterprise_shop.DelistItemSupplier_SSrv tests")
    local originalNItemSuppliers = #enterprise_shop.GetItemSuppliers()
    local itemSupplierLocator = enterprise_turtle.GetHostLocator_Att()

    -- test
    local result = enterprise_shop.DelistItemSupplier_SSrv({ itemSupplierLocator = itemSupplierLocator})
    assert(result.success == true, "DelistItemSupplier_SSrv services failed")
    local nItemSuppliers = #enterprise_shop.GetItemSuppliers()
    local expectedNItemSuppliers = originalNItemSuppliers - 1
    assert(nItemSuppliers == expectedNItemSuppliers, "gotten nItemSuppliers(="..nItemSuppliers..") not the same as expected(="..expectedNItemSuppliers..")")

    -- cleanup test
end

function t_shop.T_DelistItemSuppliers()
    -- prepare test
    corelog.WriteToLog("* enterprise_shop.DelistItemSuppliers tests")

    -- test
    enterprise_shop.DelistItemSuppliers()
    local nItemSuppliers = #enterprise_shop.GetItemSuppliers()
    local expectedNItemSuppliers = 0
    assert(nItemSuppliers == expectedNItemSuppliers, "gotten nItemSuppliers(="..nItemSuppliers..") not the same as expected(="..expectedNItemSuppliers..")")
end

return t_shop
