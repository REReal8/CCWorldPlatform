local t_shop = {}

local corelog = require "corelog"

local Callback = require "obj_callback"

local URL = require "obj_url"

local enterprise_shop = require "enterprise_shop"

local t_turtle = require "test.t_turtle"

function t_shop.T_All()
    -- base methods

    -- specific methods

    -- service methods
end

local compact = { compact = true }

local function ProvideItemsTo_ASrv_Test(provideItems)
    -- prepare test (cont)
    corelog.WriteToLog("* enterprise_shop:ProvideItemsTo_ASrv() test (of "..textutils.serialize(provideItems, compact)..")")
--    local obj = T_Chest.CreateChest(location1:getRelativeLocation(2, 5, 0)) if not obj then corelog.Error("failed obtaining Chest") return end
    local itemsLocator = enterprise_shop.GetShopLocator()
    itemsLocator:setQuery(provideItems)
    local itemDepotLocator = t_turtle.GetCurrentTurtleLocator()
    local ingredientsItemSupplierLocator = enterprise_shop.GetShopLocator()
--    local chestLocator = enterprise_chests:getObjectLocator(obj)

    local expectedDestinationItemsLocator = itemDepotLocator:copy()
    expectedDestinationItemsLocator:setQuery(provideItems)
    local callback2 = Callback:new({
        _moduleName     = "t_shop",
        _methodName     = "provideItemsTo_ASrv_Callback",
        _data           = {
            ["expectedDestinationItemsLocator"] = expectedDestinationItemsLocator,
--            ["chestLocator"]                    = chestLocator,
        },
    })

    -- test
    local scheduleResult = enterprise_shop.ProvideItemsTo_ASrv({
        itemsLocator                    = itemsLocator,
        itemDepotLocator                = itemDepotLocator,
        ingredientsItemSupplierLocator  = ingredientsItemSupplierLocator,
    }, callback2)
    assert(scheduleResult == true, "failed to schedule async service")
end

function t_shop.provideItemsTo_ASrv_Callback(callbackData, serviceResults)
    -- test (cont)
    assert(serviceResults.success, "failed executing async service")

    local destinationItemsLocator = URL:new(serviceResults.destinationItemsLocator)
    local expectedDestinationItemsLocator = URL:new(callbackData["expectedDestinationItemsLocator"])
    assert(destinationItemsLocator:isSame(expectedDestinationItemsLocator), "gotten destinationItemsLocator(="..textutils.serialize(destinationItemsLocator, compact)..") not the same as expected(="..textutils.serialize(expectedDestinationItemsLocator, compact)..")")

    -- cleanup test
--    local chestLocator = callbackData["chestLocator"]
--    enterprise_chests:deleteResource(chestLocator)

    -- end
    return true
end

function t_shop.T_ProvideMultipleItems()
    -- prepare test
    local provideItems = {
        ["minecraft:furnace"]   = 1,
        ["minecraft:charcoal"]  = 1, -- ToDo: test if furnace get produced once charcoal is being smelted (as soon as projects support parallel steps)
    }

    -- test
    ProvideItemsTo_ASrv_Test(provideItems)
end

function t_shop.T_ProvideCharcoal()
    -- prepare test
    local provideItems = {
        ["minecraft:charcoal"]  = 3,
    }

    -- test
    ProvideItemsTo_ASrv_Test(provideItems)
end

function t_shop.T_ProvideTorch()
    -- prepare test
    local provideItems = {
        ["minecraft:torch"]  = 4,
    }

    -- test
    ProvideItemsTo_ASrv_Test(provideItems)
end

return t_shop
