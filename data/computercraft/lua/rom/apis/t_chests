local itemQuery = {
    ["minecraft:birch_log"] = 1,
    ["minecraft:torch"]     = 5,
}
local multipleStacksItemQuery = {
    ["minecraft:birch_log"] = 80,
    ["minecraft:torch"]     = 1,
}

local callbackFunction = "t_main.Func1_Callback"
local callbackData = {"some callback data"}

function T_DeleteChests()
    enterprise_chests.DeleteChests()
end

function T_RegisterAndUpdateChest()
    corelog.WriteToLog("* Test Register and Update chest")

    -- create project
    local projectData = {
        chestLocation        = {x= 16, y= 17, z= 1, dx=0, dy=1},
        chestAccessDirection = "back"
    }
    local projectServiceData = {
        projectDef  = GetRegisterAndUpdateChestProjectDef(),
        projectData = projectData,
    }

    -- start project
    enterprise_projects.StartProject_ASrv(projectServiceData, callbackFunction, callbackData)
end

function GetRegisterAndUpdateChestProjectDef()
    return {
        steps = {
            { stepName = "enterprise_chests.RegisterChest_SSrv", async = false, stepDataDef = {
                { keyDef = "location"           , valueSource = 0, keyDefSource = "chestLocation" },
                { keyDef = "accessDirection"    , valueSource = 0, keyDefSource = "chestAccessDirection" },
            }},
            { stepName = "enterprise_chests.UpdateChestRecord_ASrv", async = true, stepDataDef = {
                { keyDef = "id"                 , valueSource = 1, keyDefSource = "id" },
            }},
            { stepName = "enterprise_projects.AreAllTrue_QSrv", async = false, stepDataDef = {
                { keyDef = "success1"           , valueSource = 1, keyDefSource = "success" },
                { keyDef = "success2"           , valueSource = 2, keyDefSource = "success" },
            }},
        },
        returnData = {
            { keyDef = "success"                , valueSource = 3, keyDefSource = "success" },
            { keyDef = "id"                     , valueSource = 1, keyDefSource = "id" },
        }
    }
end

local chest1Id = nil

function T_UpdateChestRecord1()
    corelog.WriteToLog("* Test UpdateChestRecord_ASrv 1")
    -- create chest data
    local chestIdData  = {
        id = chest1Id
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.UpdateChestRecord_ASrv("..textutils.serialize(chestIdData)..")")
    local result = enterprise_chests.UpdateChestRecord_ASrv(chestIdData, callbackFunction, callbackData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end

function T_RegisterChest1()
    corelog.WriteToLog("* Test RegisterChest_SSrv 1:")
    -- create chest data
    local chestData  = {
--        location        = {x= 14, y= 17, z= 1, dx=0, dy=1},
        location        = {x= 2, y= 5, z= 1, dx=0, dy=1},
        accessDirection = "top"
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.RegisterChest_SSrv("..textutils.serialize(chestData)..")")
    local result = enterprise_chests.RegisterChest_SSrv(chestData, callbackFunction, callbackData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
    if result.success then
        chest1Id = result.id
    end
end

function T_DelistChest1()
    corelog.WriteToLog("* Test DelistChests 1:")
    -- create chest data 1
    local chestData1  = {
        id = chest1Id
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.DelistChest_ASrv("..textutils.serialize(chestData1)..")")
    enterprise_chests.DelistChest_ASrv(chestData1, callbackFunction, callbackData)
end

function T_GetItemsIntoTurtle1()
    corelog.WriteToLog("* Test GetItemsIntoTurtle_ASrv for chests:")
    -- create transferData
    local sourceItemsLocator = enterprise_chests.GetItemLocator_SSrv({id = chest1Id, itemQuery = multipleStacksItemQuery}).url
    local transferData = {
        sourceItemsLocator =  sourceItemsLocator,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.GetItemsIntoTurtle_ASrv("..textutils.serialize(transferData)..","..callbackFunction..","..textutils.serialize(callbackData)..")")
    local result = enterprise_chests.GetItemsIntoTurtle_ASrv(transferData, callbackFunction, callbackData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end

function T_PutItemsFromTurtle1()
    corelog.WriteToLog("* Test PutItemsFromTurtle_ASrv for chests:")
    -- create transferData
    local turtleItemsLocator = enterprise_turtle.GetItemLocator_SSrv({ turtleId = os.getComputerID(), itemQuery = multipleStacksItemQuery }).url
    local destinationHostLocator = enterprise_chests.GetChestLocator_SSrv({id = chest1Id}).url
    local transferData = {
        turtleItemsLocator     = turtleItemsLocator,
        destinationHostLocator = destinationHostLocator,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.PutItemsFromTurtle_ASrv("..textutils.serialize(transferData)..","..callbackFunction..","..textutils.serialize(callbackData)..")")
    local result = enterprise_chests.PutItemsFromTurtle_ASrv(transferData, callbackFunction, callbackData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end

function T_ItemsAvailableVia1()
    corelog.WriteToLog("* Test ItemsAvailableVia_SSrv for chest:")
    -- create transferData
    local queryItemsLocator = enterprise_chests.GetItemLocator_SSrv({id = chest1Id, itemQuery = itemQuery}).url
    local queryData = {
        queryItemsLocator = queryItemsLocator,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_chests.ItemsAvailableVia_SSrv("..textutils.serialize(queryData)..")")
    local result = enterprise_chests.ItemsAvailableVia_SSrv(queryData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end
