--                _     _ _         __                  _   _
--               | |   | (_)       / _|                | | (_)
--    _ __  _   _| |__ | |_  ___  | |_ _   _ _ __   ___| |_ _  ___  _ __  ___
--   | '_ \| | | | '_ \| | |/ __| |  _| | | | '_ \ / __| __| |/ _ \| '_ \/ __|
--   | |_) | |_| | |_) | | | (__  | | | |_| | | | | (__| |_| | (_) | | | \__ \
--   | .__/ \__,_|_.__/|_|_|\___| |_|  \__,_|_| |_|\___|\__|_|\___/|_| |_|___/
--   | |
--   |_|

function InitialiseCoordinates_MetaData(taskData)
    local location = coremove.GetLocation() --> use the current location for proper bootstrapping

    return {
        startTime = coreutils.UniversalTime(),
        location = coremove.CopyLocation(location),
        needTool = false,
        needTurtle = true,
        fuelNeeded = 0,                         --> per definition the settler starts without fuel
        itemsNeeded = { }
    }
end

function InitialiseCoordinates_Task(taskData)
     --[[
        This Task function does the first settling step: initialise starting world coordinates.

        Return value:
            task result                 - (table)
                success                 - (boolean) whether the task was succesfull

        Parameters:
            taskData                    - (table) data about the task
                startLocation           - (table) locaton where first steps are to be taken
    ]]

    -- check input
    if type(taskData) ~= "table" or type(taskData.startLocation) ~= "table" then corelog.Error("role_settler.InitialiseCoordinates_Task: taskData not valid") return {success = false} end

    -- coordinaten stelsel goed zetten
    local startLocation = taskData.startLocation
    coremove.SetLocation(startLocation)

    -- end
    return {success = true}
end

function CollectCobbleStone_MetaData(taskData)
    return {
        startTime = coreutils.UniversalTime(),
        location = coremove.CopyLocation(taskData.startLocation),
        needTool = true,
        needTurtle = true,
        fuelNeeded = 100, -- ToDo: how much is needed for this step?
        itemsNeeded = {
        }
    }
end

function CollectCobbleStone_Task(taskData)
    -- check input
    if type(taskData) ~= "table" then corelog.Error("role_settler.CollectCobbleStone_Task: Invalid taskData") return {success = false} end
    local startLocation = taskData.startLocation
    if type(startLocation) ~= "table" then corelog.Error("role_settler.CollectCobbleStone_Task: Invalid startLocation") return {success = false} end

    -- move to the workingLocation
    coremove.GoTo(startLocation)

    -- get into digging position
    corelog.WriteToLog (">Collecting cobblestone")
    coreinventory.Equip("minecraft:diamond_pickaxe")
    turtle.digDown()
    coremove.Down()

    -- dig a hole, get cobblestone
    local cobblestone = 0
    while cobblestone < 9 do

        -- one layer lower
        turtle.digDown()
        coremove.Down()

        -- go round
        for i=1,4 do turtle.dig() coremove.Right() end

        -- count our cobblestone
        cobblestone = coreinventory.CountItem("minecraft:cobblestone")
    end

    -- restore our crafting spot
    coremove.MoveTo({z = startLocation.z - 1})
    if coreinventory.SelectItem("minecraft:dirt") or coreinventory.SelectItem("minecraft:cobblestone") then turtle.placeDown() end

    -- end
    return {success = true}
end
