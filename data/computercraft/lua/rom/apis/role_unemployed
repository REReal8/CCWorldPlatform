-- data
local db = {}

-- init functie, niks te doen lijkt me
function Init()
end

-- functions
function Execute(jobid)

    -- is de dth al beschikbaar?
    while not coredht.IsReady() do

        -- gewoon ff wachten
        os.sleep(0.25)
    end

    -- volgende job zoeken
    local jobApplication = FindBestVacancy()

    -- hebben we een job?
    if not jobApplication then return nil end

    -- inschrijven
    corejob.ApplyToJob(jobApplication)

    -- ff wachten, wellicht hebben meer zich ingeschreven
    os.sleep(0.25)

    -- controle wie de job krijgt
    return JobSelectionProcedure(jobApplication)
end

function FindBestVacancy()
    -- zoeken naar een job om op in te schrijven
    local vacancies = coredht.GetData("vacancies")

    -- kijken of we een lege lijst hebben gekregen?
    if not vacancies then return nil end

    -- op zoek naar de beste job
    for jobId, jobData in pairs(vacancies) do

        -- de eerste de beste
        return jobId
    end

    -- niks gevonden
    return nil
end

function JobSelectionProcedure(jobId)
    -- data van de job ophalen
    local jobData = coredht.GetData("vacancies", jobId, "applications")

    -- dit lijkt mij wel iets voor ons!
    if jobData  then return jobId
                else return nil end

end
