local host = "storage"
local host2 = "turtle"
local port = 1
local port2 = 5
local path = {site = 3, inputChest = 7}
local path2 = {site = 3, inputChest = 4}
local query = {["minecraft:torch"] = 5, ["minecraft:birch_log"] = 3}
local query2 = {["minecraft:torch"] = 5, ["minecraft:charcoal"] = 7}

local hostURI = "storage"
local portURI = ":1"
local pathURI = "/site=3/inputChest=7"
local queryURI = "?minecraft:birch_log=3&minecraft:torch=5"

function T_URL_Serializing()
    -- new URL
    corelog.WriteToLog("* Test URL serialize")
    local aURL = url.URLClass:new({
        _host = host,
        _port = port,
        _path = path,
        _query = query,
    })
    corelog.WriteToLog(" aURL:getURI() = "..aURL:getURI())

    corelog.WriteToLog(" aURL type = "..type(aURL))
    corelog.WriteToLog(" 1: aURL = "..aURL:getURI())
    corelog.WriteToLog(" 2: aURL = "..textutils.serialize(aURL))
end

function T_Getters()
    -- prepare test
    corelog.WriteToLog("* URL getter tests")
    local getterURL = url.URLClass:new({
        _host = host,
        _port = port,
        _path = path,
        _query = query,
    })

    -- test
    corelog.WriteToLog(" getterURL:getScheme() = "..getterURL:getScheme())
    corelog.WriteToLog(" getterURL:getSchemeURI() = "..getterURL:getSchemeURI())

    corelog.WriteToLog(" getterURL:getHost() = "..getterURL:getHost())
    corelog.WriteToLog(" getterURL:getHostURI() = "..getterURL:getHostURI())

    corelog.WriteToLog(" getterURL:getPort() = "..getterURL:getPort())
    corelog.WriteToLog(" getterURL:getPortURI() = "..getterURL:getPortURI())

    corelog.WriteToLog(" getterURL:getAuthorityURI() = "..getterURL:getAuthorityURI())

    corelog.WriteToLog(" getterURL:getPath() = "..textutils.serialize(getterURL:getPath()))
    corelog.WriteToLog(" getterURL:getPathURI() = "..getterURL:getPathURI())

    corelog.WriteToLog(" getterURL:getQuery() = "..textutils.serialize(getterURL:getQuery()))
    corelog.WriteToLog(" getterURL:getQueryURI() = "..getterURL:getQueryURI())

    corelog.WriteToLog(" getterURL:getURI() = "..getterURL:getURI())

    -- cleanup test
end

function T_Setters()
    -- prepare test
    corelog.WriteToLog("* URL setter tests")
    local setterURL = url.URLClass:new()

    -- test setterURL
    setterURL:setHost(host)
    corelog.WriteToLog(" setterURL:getHost() = "..setterURL:getHost())
    setterURL:setPort(port)
    corelog.WriteToLog(" setterURL:getPort() = "..setterURL:getPort())
    setterURL:setPath(path)
    corelog.WriteToLog(" setterURL:getPath() = "..textutils.serialize(setterURL:getPath()))
    setterURL:setQuery(query)
    corelog.WriteToLog(" setterURL:getQuery() = "..textutils.serialize(setterURL:getQuery()))
    corelog.WriteToLog(" setterURL:getURI() = "..setterURL:getURI())

    corelog.WriteToLog(" setterURL = "..textutils.serialize(setterURL))
    -- cleanup test
end

function T_SettersFromURI()
    -- prepare test
    corelog.WriteToLog("* URL setter from URI tests")
    local uriSetterURL = url.URLClass:new()
    uriSetterURL:setHostURI(hostURI)
    corelog.WriteToLog(" uriSetterURL:getHost() = "..uriSetterURL:getHost())
    uriSetterURL:setPortURI(portURI)
    corelog.WriteToLog(" uriSetterURL:getPort() = "..uriSetterURL:getPort())
    uriSetterURL:setPathURI(pathURI)
    corelog.WriteToLog(" uriSetterURL:getPath() = "..textutils.serialize(uriSetterURL:getPath()))
    uriSetterURL:setQueryURI(queryURI)
    corelog.WriteToLog(" uriSetterURL:getQuery() = "..textutils.serialize(uriSetterURL:getQuery()))
    corelog.WriteToLog(" uriSetterURL:getURI() = "..uriSetterURL:getURI())

    -- cleanup test
end

function T_NewFromURI()
    -- prepare test
    corelog.WriteToLog("* URL from URI tests (0)")
    local uriSetterURL = url.URLClass:new()

    -- test
    local newURI0=uriSetterURL:getSchemeURI()..hostURI..portURI..pathURI..queryURI
    local fromURI_URL0 = url.URLClass:newFromURI(newURI0)
    corelog.WriteToLog(" fromURI_URL0:getURI() = "..fromURI_URL0:getURI())

    corelog.WriteToLog("* URL from URI tests (1: no host)")
    local newURI1=uriSetterURL:getSchemeURI()..portURI..pathURI..queryURI
    local fromURI_URL1 = url.URLClass:newFromURI(newURI1) -- note: should fail
    corelog.WriteToLog(" fromURI_URL1:getURI() = "..fromURI_URL1:getURI())

    corelog.WriteToLog("* URL from URI tests (2: no port)")
    local newURI2=uriSetterURL:getSchemeURI()..hostURI..pathURI..queryURI
    local fromURI_URL2 = url.URLClass:newFromURI(newURI2)
    corelog.WriteToLog(" fromURI_URL2:getURI() = "..fromURI_URL2:getURI())

    corelog.WriteToLog("* URL from URI tests (3: no path)")
    local newURI3=uriSetterURL:getSchemeURI()..hostURI..portURI..queryURI
    local fromURI_URL3 = url.URLClass:newFromURI(newURI3)
    corelog.WriteToLog(" fromURI_URL3:getURI() = "..fromURI_URL3:getURI())

    corelog.WriteToLog("* URL from URI tests (4: no query)")
    local newURI4=uriSetterURL:getSchemeURI()..hostURI..portURI..pathURI
    local fromURI_URL4 = url.URLClass:newFromURI(newURI4)
    corelog.WriteToLog(" fromURI_URL4:getURI() = "..fromURI_URL4:getURI())

    -- cleanup test
end

function T_SameURLComponents()
    corelog.WriteToLog("* URL same components tests")
    -- same Host
    local aURL = url.URLClass:new({
        _host = host,
    })
    local aSameURL = url.URLClass:new({
        _host = host,
    })
    assert(aURL:sameHost(aSameURL), "hosts should be the same")
    local aDifferentURL = url.URLClass:new({
        _host = host2,
    })
    assert(not aURL:sameHost(aDifferentURL), "hosts should not be the same")

    -- same Authority
    aURL = url.URLClass:new({
        _host = host2,
        _port = port,
    })
    aSameURL = url.URLClass:new({
        _host = host2,
        _port = port,
    })
    assert(aURL:sameAuthority(aSameURL), "authority should be the same")
    aDifferentURL = url.URLClass:new({
        _host = host2,
        _port = port2,
    })
    assert(not aURL:sameAuthority(aDifferentURL), "authority should not be the same")

    -- same path
    aURL = url.URLClass:new({
        _path = path,
    })
    aSameURL = url.URLClass:new({
        _path = path,
    })
    assert(aURL:samePath(aSameURL), "path should be the same")
    aDifferentURL = url.URLClass:new({
        _path = path2,
    })
    assert(not aURL:samePath(aDifferentURL), "path should not be the same")

    -- same base
    aURL = url.URLClass:new({
        _host = host2,
        _port = port,
        _path = path,
    })
    aSameURL = url.URLClass:new({
        _host = host2,
        _port = port,
        _path = path,
    })
    assert(aURL:samePath(aSameURL), "base should be the same")
    aDifferentURL = url.URLClass:new({
        _host = host2,
        _port = port,
        _path = path2,
    })
    assert(not aURL:samePath(aDifferentURL), "base should not be the same")

    -- same query
    aURL = url.URLClass:new({
        _query = query,
    })
    aSameURL = url.URLClass:new({
        _query = query,
    })
    assert(aURL:sameQuery(aSameURL), "query should be the same")
    aDifferentURL = url.URLClass:new({
        _query = query2,
    })
    assert(not aURL:sameQuery(aDifferentURL), "query should not be the same")
end
