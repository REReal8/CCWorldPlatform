local itemQuery = {
    ["minecraft:birch_log"] = 1,
    ["minecraft:torch"]     = 5,
}

local storageURI = "ccwprp://storage"
local queryPartURI = "?minecraft:birch_log=1&minecraft:torch=5"
local storageQueryURI = storageURI.."/site=2/outputchest=4/"..queryPartURI
local factoryInputChestURI = "ccwprp://factory/site=3/inputchest=2"
local factoryOutputChestURI = "ccwprp://factory/site=3/ouputchest=1"

local callbackFunction = "t_main.Func1_Callback"
local callbackData = {"some callback data"}

--local sourceChestId = "0:1" -- ToDo: consider getting from elsewhere
--local destinationChestId = "0:2" -- ToDo: consider getting from elsewhere

function T_TransferItemsFromTo_Chests() -- ToDo: consider removing/ changing as partly already present in t_chests
    corelog.WriteToLog("* Test TransferItemsFromTo_ASrv between chests:")

    -- create project definition
    local transferItemsBetweenChestsProject = {
        services    = {
            -- preparation
            { serviceName = "enterprise_projects.StartProject_ASrv", async = true, input = {
                { keyName = "projectDefinition"         , valueSource = 0, sourceKey = "projectDefinition1" },
                { keyName = "projectInputData"          , valueSource = 0, sourceKey = "projectInputData1" },
            }},
            { serviceName = "enterprise_chests.GetItemLocator_SSrv", async = false, input = {
                { keyName = "id"                        , valueSource = 1, sourceKey = "id" },
                { keyName = "itemQuery"                 , valueSource = 0, sourceKey = "itemsToTransferQuery" },
            }},
            { serviceName = "enterprise_projects.StartProject_ASrv", async = true, input = {
                { keyName = "projectDefinition"         , valueSource = 0, sourceKey = "projectDefinition2" },
                { keyName = "projectInputData"          , valueSource = 0, sourceKey = "projectInputData2" },
            }},
            { serviceName = "enterprise_chests.GetChestLocator_SSrv", async = false, input = {
                { keyName = "id"                        , valueSource = 3, sourceKey = "id" },
            }},

            -- TransferItemsFromTo_ASrv
            { serviceName = "enterprise_isp.TransferItemsFromTo_ASrv", async = true, input = {
                { keyName = "sourceItemsLocator"       , valueSource = 2, sourceKey = "url" },
                { keyName = "destinationHostLocator"   , valueSource = 4, sourceKey = "url" },
            }},

            -- cleanup
            { serviceName = "enterprise_chests.DelistChest_ASrv", async = true, input = {
                { keyName = "id"                        , valueSource = 1, sourceKey = "id" },
            }},
            { serviceName = "enterprise_chests.DelistChest_ASrv", async = true, input = {
                { keyName = "id"                        , valueSource = 3, sourceKey = "id" },
            }},

            -- wrap-up
            { serviceName = "enterprise_projects.AreAllTrue_QSrv", async = false, input = {
                { keyName = "success1"                  , valueSource = 1, sourceKey = "success" },
                { keyName = "success2"                  , valueSource = 2, sourceKey = "success" },
                { keyName = "success3"                  , valueSource = 3, sourceKey = "success" },
                { keyName = "success4"                  , valueSource = 4, sourceKey = "success" },
                { keyName = "success5"                  , valueSource = 5, sourceKey = "success" },
                { keyName = "success6"                  , valueSource = 5, sourceKey = "success" },
                { keyName = "success7"                  , valueSource = 5, sourceKey = "success" },
            }},
        },
        returnData  = {
            { keyName = "success"                       , valueSource = 8, sourceKey = "success" },
            { keyName = "destinationItemsLocator"      , valueSource = 5, sourceKey = "destinationItemsLocator" },
        }
    }
    local serviceData = {
        projectDefinition = transferItemsBetweenChestsProject,
        projectInputData = {
            -- chest 1
            projectDefinition1 = t_chests.GetRegisterAndUpdateChestProject(),
            projectInputData1 = {
--                chestLocation        = {x= 14, y= 17, z= 1, dx=0, dy=1},
                chestLocation        = {x= 2, y= 5, z= 1, dx=0, dy=1},
                chestAccessDirection = "top",
            },

            -- query
            itemsToTransferQuery = {
                ["minecraft:birch_log"] = 3,
                ["minecraft:torch"] = 5,
            },

            -- chest 2
            projectDefinition2 = t_chests.GetRegisterAndUpdateChestProject(),
            projectInputData2 = {
--                chestLocation        = {x= 16, y= 17, z= 1, dx=0, dy=1},
                chestLocation        = {x= 8, y= 5, z= 1, dx=0, dy=1},
                chestAccessDirection = "back",
            },

        },
    }

    -- start project
    enterprise_projects.StartProject_ASrv(serviceData, callbackFunction, callbackData)
end

function T_ISPUsingProject()
    -- create project definition
    local projectInputData = {
        sourceItemsLocator = url.URLClass:newFromURI(storageQueryURI),
        localInputHostLocator = url.URLClass:newFromURI(factoryInputChestURI),
        localOutputItemsLocation = url.URLClass:newFromURI(factoryOutputChestURI),
        destinationHostLocator = url.URLClass:newFromURI(storageURI)
     }
    local aTypicalServiceUsingItemsProject = {
        services    = {
            { serviceName = "enterprise_isp.TransferItemsFromTo_ASrv", async = true, input = {
                { keyName = "sourceItemsLocator"       , valueSource = 0, sourceKey = "sourceItemsLocator" },
                { keyName = "destinationHostLocator"   , valueSource = 0, sourceKey = "localInputHostLocator" },
            }},

            -- other services (that e.g. could require items in a turtle's iventory) to implement the typical service

            { serviceName = "enterprise_isp.TransferItemsFromTo_ASrv", async = true, input = {
                { keyName = "sourceItemsLocator"       , valueSource = 0, sourceKey = "localOutputItemsLocation" },
                { keyName = "destinationHostLocator"   , valueSource = 0, sourceKey = "destinationHostLocator" },
            }},
            { serviceName = "enterprise_projects.AreAllTrue_QSrv", async = false, input = {
                { keyName = "success1"                  , valueSource = 1, sourceKey = "success" },
                { keyName = "successN"                  , valueSource = 2 --[[ likely higher]], sourceKey = "success" },
            }},
        },
        returnData  = {
            { keyName = "success"               , valueSource = 3 --[[ likely higher]], sourceKey = "success" },
        }
    }
    local serviceData = {
        projectDefinition = aTypicalServiceUsingItemsProject,
        projectInputData = projectInputData,
    }

    -- call test method
    enterprise_projects.StartProject_ASrv(serviceData, callbackFunction, callbackData)
end

function T_TransferItemsFromTo_Turtles()
    corelog.WriteToLog("* Test TransferItemsFromTo_ASrv between turtles:")
    -- create transferData
    local sourceItemsLocator = enterprise_turtle.GetItemLocator_SSrv({ turtleId = os.getComputerID(), itemQuery = itemQuery }).url
    local destinationHostLocator = enterprise_turtle.GetISHURL_SSrv({ }).url
    local transferData = {
        sourceItemsLocator =  sourceItemsLocator,
        destinationHostLocator = destinationHostLocator,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.TransferItemsFromTo_ASrv("..textutils.serialize(transferData)..","..callbackFunction..","..textutils.serialize(callbackData)..")")
    enterprise_isp.TransferItemsFromTo_ASrv(transferData, callbackFunction, callbackData)
end

function T_ItemsAvailableVia_Turtle()
    corelog.WriteToLog("* Test ItemsAvailableVia_SSrv for turtles:")
    -- create transferData
    local queryItemsLocator = enterprise_turtle.GetItemLocator_SSrv({ turtleId = os.getComputerID(), itemQuery = itemQuery }).url
    local queryData = {
        queryItemsLocator = queryItemsLocator,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.ItemsAvailableVia_SSrv("..textutils.serialize(queryData)..")")
    local result = enterprise_isp.ItemsAvailableVia_SSrv(queryData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end
