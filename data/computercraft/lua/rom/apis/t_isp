local queryPartURI = "?minecraft:birch_log=1&minecraft:torch=5"

local storageURI = "ccwprp://storage"
local storageQueryURI = storageURI.."/site=2/outputchest=4/"..queryPartURI
local factoryInputChestURI = "ccwprp://factory/site=3/inputchest=2"
local factoryOutputChestURI = "ccwprp://factory/site=3/ouputchest=1"

local callbackFunction = "t_main.Func1_Callback"
local callbackData = {"some callback data"}

function T_ISPUsingProject()
    -- create project definition
    local projectInputData = {
        itemsSourceURL = url.URLClass:newFromURI(storageQueryURI),
        itemsLocalInputURL = url.URLClass:newFromURI(factoryInputChestURI),
        itemsLocalOutputURL = url.URLClass:newFromURI(factoryOutputChestURI),
        itemsDestinationURL = url.URLClass:newFromURI(storageURI)
     }
    local aTypicalServiceUsingItemsProject = {
        services    = {
            { serviceName = "enterprise_isp.TransferItemsFromTo", async = true, input = {
                { keyName = "sourceURL"         , valueSource = 0, sourceKey = "itemsSourceURL" },
                { keyName = "destinationURL"    , valueSource = 0, sourceKey = "itemsLocalInputURL" },
            }},

            -- other services (that e.g. could require items in a turtle's iventory) to implement the typical service

            { serviceName = "enterprise_isp.TransferItemsFromTo", async = true, input = {
                { keyName = "sourceURL"         , valueSource = 0, sourceKey = "itemsLocalOutputURL" },
                { keyName = "destinationURL"    , valueSource = 0, sourceKey = "itemsDestinationURL" },
            }},
            { serviceName = "enterprise_projects.AllTrue", async = false, input = {
                { keyName = "success1"          , valueSource = 1, sourceKey = "success" },
                { keyName = "successN"          , valueSource = 2 --[[ likely higher]], sourceKey = "success" },
            }},
        },
        returnData  = {
            { keyName = "success"               , valueSource = 3 --[[ likely higher]], sourceKey = "success" },
        }
    }

    -- call test method
    enterprise_projects.StartProject(aTypicalServiceUsingItemsProject, projectInputData, callbackFunction, callbackData)
end

local sourceChestId = "0:1" -- ToDo: consider getting from elsewhere
local destinationChestId = "0:2" -- ToDo: consider getting from elsewhere

function T_TransferItemsFromTo_Chests()
    corelog.WriteToLog("* Test TransferItemsFromTo for chests:")
    -- create transferData
    local sourceURL = enterprise_chests.GetChestURL(sourceChestId)
    sourceURL:setQueryURI(queryPartURI)
    local destinationURL = enterprise_chests.GetChestURL(destinationChestId)
    local transferData = {
        sourceURL =  sourceURL,
        destinationURL = destinationURL,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.TransferItemsFromTo("..textutils.serialize(transferData)..","..callbackFunction..","..textutils.serialize(callbackData)..")")
    enterprise_isp.TransferItemsFromTo(transferData, callbackFunction, callbackData)
end

function T_ItemsAvailableVia_Chest()
    corelog.WriteToLog("* Test ItemsAvailableVia for chest:")
    -- create transferData
    local queryURL = enterprise_chests.GetChestURL(sourceChestId)
    queryURL:setQueryURI(queryPartURI)
    local queryData = {
        itemQueryURL = queryURL,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.ItemsAvailableVia("..textutils.serialize(queryData)..")")
    local result = enterprise_isp.ItemsAvailableVia(queryData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end

function T_TransferItemsFromTo_Turtle()
    corelog.WriteToLog("* Test TransferItemsFromTo for turtles:")
    -- create transferData
    local sourceURL = enterprise_turtle.GetISHURL()
    sourceURL:setQueryURI(queryPartURI)
    local destinationURL = enterprise_turtle.GetISHURL()
    local transferData = {
        sourceURL =  sourceURL,
        destinationURL = destinationURL,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.TransferItemsFromTo("..textutils.serialize(transferData)..","..callbackFunction..","..textutils.serialize(callbackData)..")")
    enterprise_isp.TransferItemsFromTo(transferData, callbackFunction, callbackData)
end

function T_ItemsAvailableVia_Turtle()
    corelog.WriteToLog("* Test ItemsAvailableVia for turtles:")
    -- create transferData
    local queryURL = enterprise_turtle.GetISHURL()
    queryURL:setQueryURI(queryPartURI)
    local queryData = {
        itemQueryURL = queryURL,
    }

    -- call test method
    corelog.WriteToLog("  calling enterprise_isp.ItemsAvailableVia("..textutils.serialize(queryData)..")")
    local result = enterprise_isp.ItemsAvailableVia(queryData)
    corelog.WriteToLog("  result="..textutils.serialize(result))
end
