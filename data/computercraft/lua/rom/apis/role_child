-- the table that stores the data
local db = {
    job         = "alchemist",
}

-- main functions
function LetItGrow()
    -- ready to start?
    local axePresent    = coreinventory.Equip("minecraft:diamond_pickaxe")
    local craftingTable = coreinventory.CountItem("minecraft:crafting_table")
    local birchSapling  = coreinventory.CountItem("minecraft:birch_sapling")

    -- stop if we don't meet the needs
    if not axePresent or craftingTable == 0 or birchSapling == 0 then
        -- no good
        print("Missing item(s) for a new start:")
        if not axePresent       then print ("* Need a diamond axe") end
        if craftingTable == 0   then print ("* Need a crafting tabel") end
        if birchSapling  == 0   then print ("* Need a birch sapling") end

        -- done here
        return false
    end

    -- plant the sappling
    coreinventory.SelectItem("minecraft:birch_sapling")
    turtle.place()

    -- remove the ground under us, usefull for crafting later
    turtle.digDown()

    -- pick up any items under us (should be nothing though)
    turtle.suckDown()

    -- wait for a tree
    local has_block, data = turtle.inspect()
    while not has_block or type(data) ~= "table" or data.name ~= "minecraft:birch_log" do
        -- ff wachten
        os.sleep(0.25)

        -- opnieuw kijken
        has_block, data = turtle.inspect()
    end

    -- blok voor ons omhakken
    turtle.dig()

    -- eerste log omzetten naar planken
    LogToPlanks(1)

    -- nu kunnen we bijtanken
    coreinventory.Refuel({itemName="minecraft:birch_planks", itemCount=4})

    -- rest van de boom omhakken
    coreinventory.Equip("minecraft:diamond_pickaxe")
    coremove.Up(1)
    role_forester.KapBoom()

    -- rest van de planken als brandstof gebruiken, kisten maken we laten (waarschijnlijk beter om eerst fakkeltje te maken trouwens, wellicht later)
    local logs      = coreinventory.CountItem("minecraft:birch_log")
    local sticks    = coreinventory.CountItem("minecraft:stick")

    -- logs to planks, leave 1 log behind
    LogToPlanks(logs - 1)
    local planks    = 4 * (logs - 1)

    -- we need 1 stick for torch and we need fuel (2 sticks or 1 plank) for furnace
    if sticks == 0 then PlanksTopStick(1) sticks = sticks + 4 end

    -- burn the planks (leave 1 behind)
    coreinventory.Refuel({itemName = "minecraft:birch_planks",  itemCount = planks - 1}) -- last plank might be used als funace fuel
    coreinventory.Refuel({itemName = "minecraft:stick",         itemCount = sticks - 3}) -- crafting torch and furnace fuel

    -- we are ready to do more stuff!
    print("We have "..coreinventory.CountItem("minecraft:birch_sapling").." birch sapling(s)")
    print("We have "..turtle.getFuelLevel().." fuel")

    -- get into digging position
    coreinventory.Equip("minecraft:diamond_pickaxe")
    turtle.digDown()
    coremove.Down()

    -- dig a hole, get cobblestone
    local cobblestone = 0
    while cobblestone < 9 do

        -- one layer lower
        turtle.digDown()
        coremove.Down()

        -- go round
        for i=1,4 do turtle.dig() coremove.Right() end

        -- count our cobblestone
        cobblestone = coreinventory.CountItem("minecraft:cobblestone")
    end

    -- restore our crafting spot
    coremove.MoveTo({z = -1})
    if coreinventory.SelectItem("minecraft:dirt") or coreinventory.SelectItem("minecraft:cobblestone") then turtle.placeDown() end

    -- craft furnace
    CobblestoneToFurnace()

    -- smelt log into charcoal

    -- craft torch

    -- expand forest

    -- wait for first tree to have regrown
end

--    _                 _    __                  _   _
--   | |               | |  / _|                | | (_)
--   | | ___   ___ __ _| | | |_ _   _ _ __   ___| |_ _  ___  _ __  ___
--   | |/ _ \ / __/ _` | | |  _| | | | '_ \ / __| __| |/ _ \| '_ \/ __|
--   | | (_) | (_| (_| | | | | | |_| | | | | (__| |_| | (_) | | | \__ \
--   |_|\___/ \___\__,_|_| |_|  \__,_|_| |_|\___|\__|_|\___/|_| |_|___/
--
--

function LogToPlanks(logs)
    role_alchemist.Craft({
        taskId = "0",
        alchemieType = "craft",
        recipe = {
            [6] = {
                itemName = "minecraft:birch_log",
                itemCount = 1
            },
            yield = 4
        },
        itemName = "minecraft:birch_planks",
        itemCount = 4 * logs,
        ingredientsLocation = "inventory",
        workingLocation = {x=0, y=0, z=0, dx=0, dy=1},
    })
end

function PlanksTopStick(plank)
    role_alchemist.Craft({
        taskId = "0",
        alchemieType = "craft",
        recipe = {
            [6] = {
                itemName = "minecraft:birch_planks",
                itemCount = 1
            },
            [10] = {
                itemName = "minecraft:birch_planks",
                itemCount = 1
            },
            yield = 4
        },
        itemName = "minecraft:stick",
        itemCount = 4 * plank,
        ingredientsLocation = "inventory",
        workingLocation = {x=0, y=0, z=0, dx=0, dy=1},
    })
end

function CobblestoneToFurnace()
    role_alchemist.Craft({
        taskId = "0",
        alchemieType = "craft",
        recipe = {
             [6] = {itemName = "minecraft:cobblestone", itemCount = 1},
             [7] = {itemName = "minecraft:cobblestone", itemCount = 1},
             [8] = {itemName = "minecraft:cobblestone", itemCount = 1},
            [10] = {itemName = "minecraft:cobblestone", itemCount = 1},
            [12] = {itemName = "minecraft:cobblestone", itemCount = 1},
            [14] = {itemName = "minecraft:cobblestone", itemCount = 1},
            [15] = {itemName = "minecraft:cobblestone", itemCount = 1},
            [16] = {itemName = "minecraft:cobblestone", itemCount = 1},
            yield = 1
        },
        itemName = "minecraft:furnace",
        itemCount = 1,
        ingredientsLocation = "inventory",
        workingLocation = {x=0, y=0, z=0, dx=0, dy=1},
    })
end

